<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <div class="mb-8">
    <h1 class="font-extrabold text-4xl text-white tracking-tight">Edit Room</h1>
    <p class="mt-2 text-gray-400">Update the room details and staff assignments.</p>
  </div>
  <div class="bg-gray-900 shadow-lg rounded-xl p-8 border border-gray-800">
    <%= form_with(model: @room, local: true) do |form| %>
      <% if @room.errors.any? %>
        <div class="bg-red-900/70 p-4 rounded mb-8 border border-red-700">
          <div class="font-semibold text-red-300">
            <%= pluralize(@room.errors.count, "error") %> prohibited this room from being saved:
          </div>
          <ul class="mt-3 list-disc list-inside text-sm text-red-200">
            <% @room.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <!-- Basic Room Information -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div>
          <%= form.label :room_number, class: "block text-sm font-semibold text-gray-200 mb-2" %>
          <%= form.text_field :room_number, class: "bg-gray-800 border border-gray-700 text-gray-100 placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm rounded-lg px-4 py-2 transition" %>
        </div>
        <div>
          <%= form.label :room_type, class: "block text-sm font-semibold text-gray-200 mb-2" %>
          <%= form.select :room_type, options_for_select(Room.room_types.map {|key, value| [key.humanize, key]}, @room.room_type), 
          { include_blank: "-- Select Room Type --"  }, class: "bg-gray-800 border border-gray-700 text-gray-100 focus:ring-indigo-500 focus:border-indigo-500 block w-full px-4 py-2 rounded-lg sm:text-sm transition" %>
        </div>
        <div>
          <%= form.label :capacity, class: "block text-sm font-semibold text-gray-200 mb-2" %>
          <%= form.number_field :capacity, class: "bg-gray-800 border border-gray-700 text-gray-100 placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm rounded-lg px-4 py-2 transition", min: 1 %>
        </div>
      </div>
      <!-- Staff Assignment -->
      <div data-controller="dragdrop-room-edit"
        data-dragdrop-room-edit-assigned-doctors-value="<%= @room.doctor_ids.to_json %>"
        data-dragdrop-room-edit-assigned-nurses-value="<%= @room.nurse_ids.to_json %>"
        class="flex justify-between items-start space-x-6">
        <!-- Doctors Section -->
        <div class="mb-8">
          <h3 class="text-lg font-semibold text-gray-200 mb-4">Assign Doctors</h3>
          <!-- Doctor Search -->
          <div class="mb-4">
            <div class="relative">
              <input type="text" 
                     data-dragdrop-room-edit-target="doctorSearch"
                     data-action="input->dragdrop-room-edit#filterDoctors"
              placeholder="Search doctors by name or specialization..."
              class="w-full px-4 py-2 pl-10 bg-gray-800 border border-gray-700 text-gray-100 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
              <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Available Doctors List -->
            <div>
              <h4 class="text-sm font-medium text-gray-300 mb-3">Available Doctors</h4>
              <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 h-64 overflow-y-auto"
                   data-dragdrop-room-edit-target="doctorsList">
                <% @doctors.each do |doctor| %>
                  <div class="doctor-card bg-gray-700 p-3 mb-3 rounded-lg cursor-move hover:bg-gray-600 transition-colors"
                       data-doctor-id="<%= doctor.id %>"
                       data-doctor-name="<%= doctor.name %>"
                       data-doctor-specialization="<%= doctor.specialization %>"
                       data-nurses-count="<%= doctor.nurses.count %>">
                    <div class="text-white font-medium"><%= doctor.name %></div>
                    <div class="text-gray-400 text-sm"><%= doctor.specialization %></div>
                    <div class="text-gray-500 text-xs mt-1"><%= doctor.nurses.count %> nurse(s)</div>
                  </div>
                <% end %>
              </div>
            </div>
            <!-- Assigned Doctors -->
            <div>
              <h4 class="text-sm font-medium text-gray-300 mb-3">Assigned Doctors</h4>
              <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 h-64 overflow-y-auto"
                   data-dragdrop-room-edit-target="assignedDoctors">
                <!-- Assigned doctors will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
        <!-- Nurses Section -->
        <div class="mb-8">
          <h3 class="text-lg font-semibold text-gray-200 mb-4">Assign Nurses</h3>
          <!-- Nurse Search -->
          <div class="mb-4">
            <div class="relative">
              <input type="text" 
                     data-dragdrop-room-edit-target="nurseSearch"
                     data-action="input->dragdrop-room-edit#filterNurses"
              placeholder="Search nurses by name or specialization..."
              class="w-full px-4 py-2 pl-10 bg-gray-800 border border-gray-700 text-gray-100 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
              <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Available Nurses List -->
            <div>
              <h4 class="text-sm font-medium text-gray-300 mb-3">Available Nurses</h4>
              <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 h-64 overflow-y-auto"
                   data-dragdrop-room-edit-target="nursesList">
                <% @nurses.each do |nurse| %>
                  <div class="nurse-card bg-gray-700 p-3 mb-3 rounded-lg cursor-move hover:bg-gray-600 transition-colors"
                       data-nurse-id="<%= nurse.id %>"
                       data-nurse-name="<%= nurse.name %>"
                       data-nurse-specialization="<%= nurse.specialization %>"
                       data-nurse-doctor="<%= nurse.doctor&.name || 'Unassigned' %>">
                    <div class="text-white font-medium"><%= nurse.name %></div>
                    <div class="text-gray-400 text-sm"><%= nurse.specialization %></div>
                    <div class="text-gray-500 text-xs mt-1">
                      Doctor: <%= nurse.doctor&.name || 'Unassigned' %>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
            <!-- Assigned Nurses -->
            <div>
              <h4 class="text-sm font-medium text-gray-300 mb-3">Assigned Nurses</h4>
              <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 h-64 overflow-y-auto"
                   data-dragdrop-room-edit-target="assignedNurses">
                <!-- Assigned nurses will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
        <!-- Hidden form fields for selected doctors and nurses -->
        <div data-dragdrop-room-edit-target="hiddenFields">
          <!-- Hidden fields will be generated by JavaScript -->
        </div>
      </div>
      <div class="flex justify-end mt-8">
        <%= form.submit "Update Room", class: "inline-flex items-center px-6 py-2 border border-transparent text-base font-semibold rounded-lg shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition" %>
      </div>
    <% end %>
  </div>
  <div class="mt-10 text-center">
    <%= link_to "← Back to Room", room_path(@room), class: "text-indigo-400 hover:text-indigo-200 font-medium transition" %>
  </div>
</div>
